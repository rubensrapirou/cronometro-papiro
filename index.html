<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>VOC√ä SARGENTO ‚Äî Opera√ß√£o Elite</title>
<link rel="icon" href="logo.png" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;600;800&family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />
<style>
/* O mesmo estilo preto dourado que te passei */
:root {
  --bg1: #000000;
  --bg2: #191919;
  --accent: #ffd700;
  --success: #65cc8f;
  --warning: #ffd84f;
  --danger: #ee663f;
  --muted: rgba(255, 255, 255, 0.08);
}
/* restantes dos estilos iguais ao enviado anteriormente */
</style>
</head>
<body>
<div class="container">
  <!-- seu HTML dos cards aqui conforme acima, com os ids corretos para mainRanking, sideRanking, etc. -->
</div>

<script type="module">
// IMPORTS obrigatoriamente no topo
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";

// Configura√ß√£o Firebase
const firebaseConfig = {
  apiKey: "AIzaSyBniRu4I1epvafxttRsdyfDIpUGT63ytsU",
  authDomain: "voce-sargento.firebaseapp.com",
  projectId: "voce-sargento",
  storageBucket: "voce-sargento.firebasestorage.app",
  messagingSenderId: "144820811065",
  appId: "1:144820811065:web:fe0f99e9f57947722724e8",
  measurementId: "G-5F4EXDDPD0"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

document.addEventListener("DOMContentLoaded", () => {

  // Selector helper
  const $ = id => document.getElementById(id);

  // Elementos e vari√°veis
  const loginBtn = $('loginBtn'), registerBtn = $('registerBtn'), guestBtn = $('guestBtn');
  const logoutBtn = $('logoutBtn'), setMetaBtn = $('setMetaBtn');
  const authBox = $('authBox'), profileBox = $('profileBox');
  const usernameInput = $('username'), passwordInput = $('password');
  const welcomeName = $('welcomeName'), streakEl = $('streak'), metaText = $('metaText');
  const timeDisplay = $('timeDisplay'), startBtn = $('startBtn'), pauseBtn = $('pauseBtn'), resetBtn = $('resetBtn');
  const hoursInput = $('hours'), minutesInput = $('minutes'), secondsInput = $('seconds');
  const progressFill = $('progressFill'), mainRanking = $('mainRanking'), sideRanking = $('sideRanking'), totalUsers = $('totalUsers');
  let currentUser = null, interval = null, running = false, totalSeconds = 0, remaining = 0;

  // Hash de senha
  async function hashPassword(pw) {
    const enc = new TextEncoder();
    const hashBuffer = await crypto.subtle.digest('SHA-256', enc.encode(pw));
    return Array.from(new Uint8Array(hashBuffer)).map(b => b.toString(16).padStart(2,'0')).join('');
  }

  // Fun√ß√µes de login, cadastro, exibi√ß√£o, controle de cronometro e ranking
  async function registerUser() {
    const username = usernameInput.value.trim().toLowerCase();
    const password = passwordInput.value;
    if (!username) return alert('Digite um usu√°rio');
    const ref = doc(db, 'users', username);
    const snap = await getDoc(ref);
    if(snap.exists()) return alert('Usu√°rio j√° existe');
    const pwHash = await hashPassword(password);
    await setDoc(ref, {username, pwHash, streak:0, lastStudy:null, sessions:0});
    alert('Conta criada. Fa√ßa login.');
  }

  async function loginUser() {
    const username = usernameInput.value.trim().toLowerCase();
    const password = passwordInput.value;
    if(!username) return alert('Digite usu√°rio');
    const ref = doc(db, 'users', username);
    const snap = await getDoc(ref);
    if(!snap.exists()) return alert('Usu√°rio n√£o encontrado.');
    const data = snap.data();
    const hash = await hashPassword(password);
    if(hash !== data.pwHash) return alert('Senha incorreta');
    currentUser = {username, ...data};
    localStorage.setItem('vs_user', username);
    showProfile();
    fetchRanking();
  }

  loginBtn.onclick = loginUser;
  registerBtn.onclick = registerUser;
  guestBtn.onclick = () => {
    currentUser = null;
    localStorage.removeItem('vs_user');
    authBox.style.display = 'none';
    profileBox.style.display = 'none';
    fetchRanking();
  };
  logoutBtn.onclick = () => {
    currentUser = null;
    localStorage.removeItem('vs_user');
    authBox.style.display = 'block';
    profileBox.style.display = 'none';
  };

  function showProfile() {
    authBox.style.display = 'none';
    profileBox.style.display = 'block';
    welcomeName.textContent = currentUser.username;
    streakEl.textContent = 'üìÖ Const√¢ncia: '+(currentUser.streak || 0)+' dias';
  }

  function formatTime(sec) {
    const h = Math.floor(sec/3600), m = Math.floor((sec%3600)/60), s = sec%60;
    return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
  }

  startBtn.onclick = () => {
    if(running) return;
    const h = parseInt(hoursInput.value) || 0;
    const m = parseInt(minutesInput.value) || 0;
    const s = parseInt(secondsInput.value) || 0;
    totalSeconds = h*3600 + m*60 + s;
    if(totalSeconds <= 0) return alert('Defina um tempo v√°lido');
    remaining = totalSeconds;
    running = true;
    interval = setInterval(async () => {
      remaining--;
      progressFill.style.width = `${(1 - remaining/totalSeconds)*100}%`;
      timeDisplay.textContent = formatTime(remaining);
      if(remaining <= 0) {
        clearInterval(interval);
        running = false;
        alert('Sess√£o conclu√≠da!');
        if(currentUser) {
          const ref = doc(db, 'users', currentUser.username);
          const snap = await getDoc(ref);
          const data = snap.data();
          let streak = data.streak || 0;
          const today = new Date().toDateString();
          const last = data.lastStudy ? new Date(data.lastStudy).toDateString() : null;
          if(last === today) return;
          if(last) {
            const diff = Math.round((new Date(today) - new Date(last)) / (1000*60*60*24));
            if(diff === 1) streak++; else streak = 1;
          } else streak = 1;
          await updateDoc(ref, {streak, lastStudy: new Date().toISOString(), sessions: (data.sessions || 0)+1});
          fetchRanking();
          showProfile();
        }
      }
    }, 1000);
  };

  pauseBtn.onclick = () => {
    if(!running) return;
    clearInterval(interval);
    running = false;
  };
  resetBtn.onclick = () => {
    clearInterval(interval);
    running = false;
    progressFill.style.width = '0%';
    timeDisplay.textContent = '00:00:00';
  };

  async function fetchRanking() {
    const q = query(collection(db, 'users'), orderBy('streak', 'desc'), limit(50));
    const snaps = await getDocs(q);
    let list = [];
    snaps.forEach(s => {
      const d = s.data();
      list.push({username: d.username || s.id, streak: d.streak || 0, sessions: d.sessions || 0});
    });
    totalUsers.textContent = list.length;
    mainRanking.innerHTML = '';
    sideRanking.innerHTML = '';
    list.slice(0,10).forEach((u, idx) => {
      const div = document.createElement('div');
      div.className = 'rank-item';
      div.innerHTML = `<div><strong>${idx+1}. ${u.username}</strong><div class='small'>${u.sessions} sess√µes</div></div><div style='font-weight:700'>${u.streak} dias</div>`;
      mainRanking.appendChild(div);
      sideRanking.appendChild(div.cloneNode(true));
    });
  }
  fetchRanking();
  setInterval(fetchRanking, 20000);

});
</script>
</body>
</html>
